<?php
declare(strict_types=1);

#if (${NAMESPACE})
namespace ${NAMESPACE};

#end
use ${ItemInterfaceNamespace};

class ${NAME} extends \ArrayIterator implements ${NAME}Interface
{
     /** @param \\${ItemInterfaceNamespace} ...${DS}${arrayItemName}s */
    public function __construct(array ${DS}${arrayItemName}s = array(), int ${DS}flags = 0)
    {
        if (!empty(${DS}${arrayItemName}s)) {
            ${DS}this->_assertValidArrayType(...${DS}${arrayItemName}s);
        }

        parent::__construct(${DS}${arrayItemName}s, ${DS}flags);
    }

    public function offsetGet(${DS}index): \\${ItemInterfaceNamespace}
    {
        return ${DS}this->_assertValidArrayItemType(parent::offsetGet(${DS}index));
    }

    /** @param \\${ItemInterfaceNamespace} ${DS}${arrayItemName} */
    public function offsetSet(${DS}index, ${DS}${arrayItemName})
    {
        parent::offsetSet(${DS}index, ${DS}this->_assertValidArrayItemType(${DS}${arrayItemName}));
    }

    /** @param \\${ItemInterfaceNamespace} ${DS}${arrayItemName} */
    public function append(${DS}${arrayItemName})
    {
        ${DS}this->_assertValidArrayItemType(${DS}${arrayItemName});
        parent::append(${DS}${arrayItemName});
    }

    public function current(): \\${ItemInterfaceNamespace}
    {
        return parent::current();
    }

    protected function _assertValidArrayItemType(\\${ItemInterfaceNamespace} ${DS}${arrayItemName})
    {
        return ${DS}${arrayItemName};
    }

    protected function _assertValidArrayType(\\${ItemInterfaceNamespace} ...${DS}${arrayItemName}s): ${NAME}Interface
    {
        return ${DS}this;
    }
}
